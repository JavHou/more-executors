
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Reference &#8212; more-executors  documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="User Guide" href="user-guide.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="reference">
<h1>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h1>
<div class="section" id="bind">
<h2>bind<a class="headerlink" href="#bind" title="Permalink to this headline">¶</a></h2>
<dl class="classmethod">
<dt id="more_executors.Executors.bind">
<em class="property">classmethod </em><code class="descclassname">Executors.</code><code class="descname">bind</code><span class="sig-paren">(</span><em>executor</em>, <em>fn</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.Executors.bind" title="Permalink to this definition">¶</a></dt>
<dd><p>Bind a callable to an executor.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>executor</strong> (<a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Executor" title="(in Python v3.7)"><em>Executor</em></a>) – an executor</li>
<li><strong>fn</strong> (<em>callable</em>) – any function or callable</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>A new callable which, when invoked, will submit <cite>fn</cite> to <cite>executor</cite> and return
the resulting future.</p>
<p>This returned callable provides the <cite>Executors.with_*</cite> methods, which may be
chained to further customize the behavior of the callable.</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">callable</p>
</td>
</tr>
</tbody>
</table>
<div class="versionadded">
<p><span class="versionmodified">New in version 1.13.0.</span></p>
</div>
</dd></dl>

</div>
<div class="section" id="concurrent-futures">
<h2>concurrent.futures<a class="headerlink" href="#concurrent-futures" title="Permalink to this headline">¶</a></h2>
<p>A few convenience methods are provided for the creation of
<a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#module-concurrent.futures" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">concurrent.futures</span></code></a> executors. The executors produced by these methods
include the <code class="xref py py-class docutils literal notranslate"><span class="pre">more_executors.Executors</span></code> <cite>with_*</cite> methods for
<a class="reference internal" href="user-guide.html#composing-executors"><span class="std std-ref">Composing executors</span></a>.</p>
<dl class="classmethod">
<dt id="more_executors.Executors.thread_pool">
<em class="property">classmethod </em><code class="descclassname">Executors.</code><code class="descname">thread_pool</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.Executors.thread_pool" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a thread pool executor.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">a new executor, initialized with the given arguments</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor" title="(in Python v3.7)">ThreadPoolExecutor</a></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="more_executors.Executors.process_pool">
<em class="property">classmethod </em><code class="descclassname">Executors.</code><code class="descname">process_pool</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.Executors.process_pool" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a process pool executor.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">a new executor, initialized with the given arguments</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.ProcessPoolExecutor" title="(in Python v3.7)">ProcessPoolExecutor</a></td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="sync">
<h2>sync<a class="headerlink" href="#sync" title="Permalink to this headline">¶</a></h2>
<p>SyncExecutor is a base executor which invokes any submitted callables
immediately in the calling thread.</p>
<dl class="class">
<dt id="more_executors.sync.SyncExecutor">
<em class="property">class </em><code class="descclassname">more_executors.sync.</code><code class="descname">SyncExecutor</code><span class="sig-paren">(</span><em>logger=None</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.sync.SyncExecutor" title="Permalink to this definition">¶</a></dt>
<dd><p>An executor which immediately invokes all submitted callables.</p>
<p>This executor is useful for testing.  With executor implementations
such as <a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ThreadPoolExecutor</span></code></a>, it’s possible
(though rare) for a future to be resolved before being returned to the
caller.  This may have an impact on the caller’s code (for example,
<a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Future.add_done_callback" title="(in Python v3.7)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_done_callback()</span></code></a> if called on a done
future will invoke callbacks immediately in the calling thread).</p>
<p>With this executor, that’s guaranteed to always be the case.  Thus it can
be used to test code paths which are otherwise rarely triggered.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>logger</strong> (<a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.Logger" title="(in Python v3.7)"><em>Logger</em></a>) – a logger used for messages from this executor</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="more_executors.sync.SyncExecutor.submit">
<code class="descname">submit</code><span class="sig-paren">(</span><em>fn</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.sync.SyncExecutor.submit" title="Permalink to this definition">¶</a></dt>
<dd><p>Immediately invokes <cite>fn(*args, **kwargs)</cite> and returns a future
with the result (or exception).</p>
</dd></dl>

</dd></dl>

<dl class="classmethod">
<dt id="more_executors.Executors.sync">
<em class="property">classmethod </em><code class="descclassname">Executors.</code><code class="descname">sync</code><span class="sig-paren">(</span><em>logger=None</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.Executors.sync" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a new synchronous executor.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">a new synchronous executor</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#more_executors.sync.SyncExecutor" title="more_executors.sync.SyncExecutor">SyncExecutor</a></td>
</tr>
</tbody>
</table>
<p>Submitted functions will be immediately invoked on the calling thread.</p>
</dd></dl>

</div>
<div class="section" id="retry">
<h2>retry<a class="headerlink" href="#retry" title="Permalink to this headline">¶</a></h2>
<p>RetryExecutor produces futures which will implicitly retry on error.</p>
<dl class="class">
<dt id="more_executors.retry.RetryExecutor">
<em class="property">class </em><code class="descclassname">more_executors.retry.</code><code class="descname">RetryExecutor</code><span class="sig-paren">(</span><em>delegate</em>, <em>retry_policy=None</em>, <em>logger=None</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.retry.RetryExecutor" title="Permalink to this definition">¶</a></dt>
<dd><p>An executor which delegates to another executor while adding
implicit retry behavior.</p>
<ul class="simple">
<li>Callables are submitted to the delegate executor, and may be
submitted more than once if retries are required.</li>
<li>The callables may be submitted to that executor from a different
thread than the calling thread.</li>
<li>Cancelling is supported if the delegate executor allows it.</li>
<li>Cancelling between retries is always supported.</li>
<li>The returned futures from this executor are only resolved or
failed once the callable either succeeded, or all retries
were exhausted.  This includes activation of the done callback.</li>
<li>This executor is thread-safe.</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>delegate</strong> (<a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Executor" title="(in Python v3.7)"><em>Executor</em></a>) – executor to which callables will be submitted</li>
<li><strong>retry_policy</strong> (<a class="reference internal" href="#more_executors.retry.RetryPolicy" title="more_executors.retry.RetryPolicy"><em>RetryPolicy</em></a>) – policy used to determine when futures shall be retried; if omitted,
a default <a class="reference internal" href="#more_executors.retry.ExceptionRetryPolicy" title="more_executors.retry.ExceptionRetryPolicy"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExceptionRetryPolicy</span></code></a> is used</li>
<li><strong>logger</strong> (<a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.Logger" title="(in Python v3.7)"><em>Logger</em></a>) – a logger used for messages from this executor</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="classmethod">
<dt id="more_executors.retry.RetryExecutor.new_default">
<em class="property">classmethod </em><code class="descname">new_default</code><span class="sig-paren">(</span><em>delegate</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.retry.RetryExecutor.new_default" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">an executor with a reasonable default retry policy</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="more_executors.retry.RetryExecutor.submit_retry">
<code class="descname">submit_retry</code><span class="sig-paren">(</span><em>retry_policy</em>, <em>fn</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.retry.RetryExecutor.submit_retry" title="Permalink to this definition">¶</a></dt>
<dd><p>Submit a callable with a specific retry policy.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>retry_policy</strong> (<a class="reference internal" href="#more_executors.retry.RetryPolicy" title="more_executors.retry.RetryPolicy"><em>RetryPolicy</em></a>) – a policy which is used for this call only</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="classmethod">
<dt id="more_executors.Executors.with_retry">
<em class="property">classmethod </em><code class="descclassname">Executors.</code><code class="descname">with_retry</code><span class="sig-paren">(</span><em>executor</em>, <em>retry_policy=None</em>, <em>logger=None</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.Executors.with_retry" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">a new executor which will retry callables on failure</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#more_executors.retry.RetryExecutor" title="more_executors.retry.RetryExecutor">RetryExecutor</a></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="more_executors.retry.RetryPolicy">
<em class="property">class </em><code class="descclassname">more_executors.retry.</code><code class="descname">RetryPolicy</code><a class="headerlink" href="#more_executors.retry.RetryPolicy" title="Permalink to this definition">¶</a></dt>
<dd><p>Instances of this class may be supplied to <a class="reference internal" href="#more_executors.retry.RetryExecutor" title="more_executors.retry.RetryExecutor"><code class="xref py py-class docutils literal notranslate"><span class="pre">RetryExecutor</span></code></a>
to customize the retry behavior.</p>
<p>This base class will never retry.  See <a class="reference internal" href="#more_executors.retry.ExceptionRetryPolicy" title="more_executors.retry.ExceptionRetryPolicy"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExceptionRetryPolicy</span></code></a> for
a general-purpose implementation.</p>
<dl class="method">
<dt id="more_executors.retry.RetryPolicy.should_retry">
<code class="descname">should_retry</code><span class="sig-paren">(</span><em>attempt</em>, <em>future</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.retry.RetryPolicy.should_retry" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>attempt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – number of times the future has been attempted; starts counting at 1</li>
<li><strong>future</strong> (<a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Future" title="(in Python v3.7)"><em>Future</em></a>) – a completed future</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">True if and only if a future should be retried.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)">bool</a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="more_executors.retry.RetryPolicy.sleep_time">
<code class="descname">sleep_time</code><span class="sig-paren">(</span><em>attempt</em>, <em>future</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.retry.RetryPolicy.sleep_time" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>attempt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – number of times the future has been attempted; starts counting at 1</li>
<li><strong>future</strong> (<a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Future" title="(in Python v3.7)"><em>Future</em></a>) – a completed future</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The amount of time (in seconds) to delay before the next
attempt at running a future.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)">float</a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="more_executors.retry.ExceptionRetryPolicy">
<em class="property">class </em><code class="descclassname">more_executors.retry.</code><code class="descname">ExceptionRetryPolicy</code><span class="sig-paren">(</span><em>max_attempts</em>, <em>exponent</em>, <em>sleep</em>, <em>max_sleep</em>, <em>exception_base</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.retry.ExceptionRetryPolicy" title="Permalink to this definition">¶</a></dt>
<dd><p>Retries on any exceptions under the given base class,
up to a fixed number of attempts, with an exponential
backoff between each attempt.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>max_attempts</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – maximum number of times a callable should be attempted</li>
<li><strong>exponent</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – exponent used for backoff, e.g. 2.0 will result in a delay
which doubles between each attempt</li>
<li><strong>sleep</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – base value for delay between attempts in seconds, e.g. 1.0
will delay by one second between first two attempts</li>
<li><strong>max_sleep</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – maximum delay between attempts, in seconds</li>
<li><strong>exception_base</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#type" title="(in Python v3.7)"><em>type</em></a>) – future will be retried if (and only if) it raises
an exception inheriting from this class</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="classmethod">
<dt id="more_executors.retry.ExceptionRetryPolicy.new_default">
<em class="property">classmethod </em><code class="descname">new_default</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.retry.ExceptionRetryPolicy.new_default" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns:
a new policy with a reasonable implementation:</p>
<ul class="simple">
<li>allows up to 10 attempts</li>
<li>retries on any <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#Exception" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></a></li>
</ul>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="map">
<h2>map<a class="headerlink" href="#map" title="Permalink to this headline">¶</a></h2>
<p>MapExecutor allows transforming the output value of a future.</p>
<dl class="class">
<dt id="more_executors.map.MapExecutor">
<em class="property">class </em><code class="descclassname">more_executors.map.</code><code class="descname">MapExecutor</code><span class="sig-paren">(</span><em>delegate</em>, <em>fn</em>, <em>logger=None</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.map.MapExecutor" title="Permalink to this definition">¶</a></dt>
<dd><p>An executor which delegates to another executor while mapping
output values through a given function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>delegate</strong> (<a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Executor" title="(in Python v3.7)"><em>Executor</em></a>) – an executor to which callables will be submitted</li>
<li><strong>fn</strong> (<em>callable</em>) – a callable applied to transform returned values</li>
<li><strong>logger</strong> (<a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.Logger" title="(in Python v3.7)"><em>Logger</em></a>) – a logger used for messages from this executor</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="more_executors.map.MapExecutor.submit">
<code class="descname">submit</code><span class="sig-paren">(</span><em>fn</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.map.MapExecutor.submit" title="Permalink to this definition">¶</a></dt>
<dd><p>Submit a callable.</p>
<p>The returned future will have its output value transformed by the
map function passed to this executor.  If that map function raises
an exception, the future will fail with that exception.</p>
</dd></dl>

</dd></dl>

<dl class="classmethod">
<dt id="more_executors.Executors.with_map">
<em class="property">classmethod </em><code class="descclassname">Executors.</code><code class="descname">with_map</code><span class="sig-paren">(</span><em>executor</em>, <em>fn</em>, <em>logger=None</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.Executors.with_map" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">a new executor which will transform results through the given function</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#more_executors.map.MapExecutor" title="more_executors.map.MapExecutor">MapExecutor</a></td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="flat-map">
<h2>flat map<a class="headerlink" href="#flat-map" title="Permalink to this headline">¶</a></h2>
<p>FlatMapExecutor allows transforming the output value of a future
asynchronously.</p>
<dl class="class">
<dt id="more_executors.flat_map.FlatMapExecutor">
<em class="property">class </em><code class="descclassname">more_executors.flat_map.</code><code class="descname">FlatMapExecutor</code><span class="sig-paren">(</span><em>delegate</em>, <em>fn</em>, <em>logger=None</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.flat_map.FlatMapExecutor" title="Permalink to this definition">¶</a></dt>
<dd><p>An executor which delegates to another executor while mapping
output values through a given future-producing function.</p>
<p>This executor behaves like <a class="reference internal" href="#more_executors.map.MapExecutor" title="more_executors.map.MapExecutor"><code class="xref py py-class docutils literal notranslate"><span class="pre">MapExecutor</span></code></a>,
except that the given mapping function must return instances of
<a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Future" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Future</span></code></a>, and the mapped future is
flattened into the future returned from this executor.
This allows chaining multiple future-producing functions into a single
future.</p>
<ul class="simple">
<li>If the map function returns a <a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Future" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Future</span></code></a>, the
result/exception of that future will be propagated to the future returned
by this executor.</li>
<li>If the map function returns any other type, the returned future will fail
with a <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeError</span></code></a>.</li>
<li>If the map function raises an exception, the returned future will fail
with that exception.</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>delegate</strong> (<a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Executor" title="(in Python v3.7)"><em>Executor</em></a>) – an executor to which callables will be submitted</li>
<li><strong>fn</strong> (<em>callable</em>) – a callable applied to transform returned values</li>
<li><strong>logger</strong> (<a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.Logger" title="(in Python v3.7)"><em>Logger</em></a>) – a logger used for messages from this executor</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="more_executors.Executors.with_flat_map">
<em class="property">classmethod </em><code class="descclassname">Executors.</code><code class="descname">with_flat_map</code><span class="sig-paren">(</span><em>executor</em>, <em>fn</em>, <em>logger=None</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.Executors.with_flat_map" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">a new executor which will transform results through the given
<a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Future" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Future</span></code></a>-providing function</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#more_executors.flat_map.FlatMapExecutor" title="more_executors.flat_map.FlatMapExecutor">FlatMapExecutor</a></td>
</tr>
</tbody>
</table>
<div class="versionadded">
<p><span class="versionmodified">New in version 1.12.0.</span></p>
</div>
</dd></dl>

</div>
<div class="section" id="timeout">
<h2>timeout<a class="headerlink" href="#timeout" title="Permalink to this headline">¶</a></h2>
<p>TimeoutExecutor cancels pending futures after a timeout is reached.</p>
<dl class="class">
<dt id="more_executors.timeout.TimeoutExecutor">
<em class="property">class </em><code class="descclassname">more_executors.timeout.</code><code class="descname">TimeoutExecutor</code><span class="sig-paren">(</span><em>delegate</em>, <em>timeout</em>, <em>logger=None</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.timeout.TimeoutExecutor" title="Permalink to this definition">¶</a></dt>
<dd><p>An executor which delegates to another executor while applying
a timeout to each returned future.</p>
<p>For any futures returned by this executor, if the future hasn’t
completed approximately within <cite>timeout</cite> seconds of its creation,
an attempt will be made to cancel the future.</p>
<p>Note that only a single attempt is made to cancel any future, and there
is no guarantee that this will succeed.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 1.7.0.</span></p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>delegate</strong> (<a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Executor" title="(in Python v3.7)"><em>Executor</em></a>) – an executor to which callables are submitted</li>
<li><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – timeout (in seconds) after which <a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Future.cancel" title="(in Python v3.7)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">concurrent.futures.Future.cancel()</span></code></a>
will be invoked on any generated future which has not completed</li>
<li><strong>logger</strong> (<a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.Logger" title="(in Python v3.7)"><em>Logger</em></a>) – a logger used for messages from this executor</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="more_executors.Executors.with_timeout">
<em class="property">classmethod </em><code class="descclassname">Executors.</code><code class="descname">with_timeout</code><span class="sig-paren">(</span><em>executor</em>, <em>timeout</em>, <em>logger=None</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.Executors.with_timeout" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">a new executor which will attempt to cancel any futures if they’ve
not completed within the given timeout.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#more_executors.timeout.TimeoutExecutor" title="more_executors.timeout.TimeoutExecutor">TimeoutExecutor</a></td>
</tr>
</tbody>
</table>
<div class="versionadded">
<p><span class="versionmodified">New in version 1.7.0.</span></p>
</div>
</dd></dl>

</div>
<div class="section" id="throttle">
<h2>throttle<a class="headerlink" href="#throttle" title="Permalink to this headline">¶</a></h2>
<p>ThrottleExecutor limits the number of concurrently executing futures.</p>
<dl class="class">
<dt id="more_executors.throttle.ThrottleExecutor">
<em class="property">class </em><code class="descclassname">more_executors.throttle.</code><code class="descname">ThrottleExecutor</code><span class="sig-paren">(</span><em>delegate</em>, <em>count</em>, <em>logger=None</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.throttle.ThrottleExecutor" title="Permalink to this definition">¶</a></dt>
<dd><p>An executor which delegates to another executor while enforcing
a limit on the number of futures running concurrently.</p>
<ul class="simple">
<li>Callables are submitted to the delegate executor, from a different
thread than the calling thread.</li>
<li>Where <cite>count</cite> is used to initialize this executor, if there
are already <cite>count</cite> futures submitted to the delegate executor and not
yet <a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Future.done" title="(in Python v3.7)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">done()</span></code></a>, additional callables will
be queued and only submitted to the delegate executor once there are
less than <cite>count</cite> futures in progress.</li>
</ul>
<div class="versionadded">
<p><span class="versionmodified">New in version 1.9.0.</span></p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>delegate</strong> (<a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Executor" title="(in Python v3.7)"><em>Executor</em></a>) – an executor to which callables will be submitted</li>
<li><strong>count</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – maximum number of concurrently running futures</li>
<li><strong>logger</strong> (<a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.Logger" title="(in Python v3.7)"><em>Logger</em></a>) – a logger used for messages from this executor</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="more_executors.Executors.with_throttle">
<em class="property">classmethod </em><code class="descclassname">Executors.</code><code class="descname">with_throttle</code><span class="sig-paren">(</span><em>executor</em>, <em>count</em>, <em>logger=None</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.Executors.with_throttle" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">a new executor which enforces a limit on the number of concurrently
pending futures.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#more_executors.throttle.ThrottleExecutor" title="more_executors.throttle.ThrottleExecutor">ThrottleExecutor</a></td>
</tr>
</tbody>
</table>
<div class="versionadded">
<p><span class="versionmodified">New in version 1.9.0.</span></p>
</div>
</dd></dl>

</div>
<div class="section" id="cancel-on-shutdown">
<h2>cancel on shutdown<a class="headerlink" href="#cancel-on-shutdown" title="Permalink to this headline">¶</a></h2>
<p>CancelOnShutdownExecutor cancels any pending futures when an executor is
shut down.</p>
<dl class="class">
<dt id="more_executors.cancel_on_shutdown.CancelOnShutdownExecutor">
<em class="property">class </em><code class="descclassname">more_executors.cancel_on_shutdown.</code><code class="descname">CancelOnShutdownExecutor</code><span class="sig-paren">(</span><em>delegate</em>, <em>logger=None</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.cancel_on_shutdown.CancelOnShutdownExecutor" title="Permalink to this definition">¶</a></dt>
<dd><p>An executor which delegates to another executor and cancels all
futures when the executor is shut down.</p>
<p>This class is useful in conjunction with executors having custom cancel
behavior, such as <a class="reference internal" href="#more_executors.poll.PollExecutor" title="more_executors.poll.PollExecutor"><code class="xref py py-class docutils literal notranslate"><span class="pre">PollExecutor</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>delegate</strong> (<a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Executor" title="(in Python v3.7)"><em>Executor</em></a>) – executor to which callables will be submitted</li>
<li><strong>logger</strong> (<a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.Logger" title="(in Python v3.7)"><em>Logger</em></a>) – a logger used for messages from this executor</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="more_executors.cancel_on_shutdown.CancelOnShutdownExecutor.shutdown">
<code class="descname">shutdown</code><span class="sig-paren">(</span><em>wait=True</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.cancel_on_shutdown.CancelOnShutdownExecutor.shutdown" title="Permalink to this definition">¶</a></dt>
<dd><p>Shut down the executor.</p>
<p>All futures created by this executor which have not yet been completed
will have <a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Future.cancel" title="(in Python v3.7)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">cancel()</span></code></a> invoked.</p>
<p>Note that there is no guarantee that the cancel will succeed, and only a single
attempt is made to cancel any future.</p>
</dd></dl>

</dd></dl>

<dl class="classmethod">
<dt id="more_executors.Executors.with_cancel_on_shutdown">
<em class="property">classmethod </em><code class="descclassname">Executors.</code><code class="descname">with_cancel_on_shutdown</code><span class="sig-paren">(</span><em>executor</em>, <em>logger=None</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.Executors.with_cancel_on_shutdown" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">a new executor which attempts to cancel any pending futures when
the executor is shut down.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#more_executors.cancel_on_shutdown.CancelOnShutdownExecutor" title="more_executors.cancel_on_shutdown.CancelOnShutdownExecutor">CancelOnShutdownExecutor</a></td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="poll">
<h2>poll<a class="headerlink" href="#poll" title="Permalink to this headline">¶</a></h2>
<p>PollExecutor allows producing futures which should be resolved via a
custom poll function.</p>
<div class="section" id="poll-function">
<span id="id1"></span><h3>Poll function<a class="headerlink" href="#poll-function" title="Permalink to this headline">¶</a></h3>
<p>The poll function has the following semantics:</p>
<ul class="simple">
<li>It’s called with a single argument, a list of zero or more
<a class="reference internal" href="#more_executors.poll.PollDescriptor" title="more_executors.poll.PollDescriptor"><code class="xref py py-class docutils literal notranslate"><span class="pre">more_executors.poll.PollDescriptor</span></code></a> objects.</li>
<li>If the poll function can determine that a particular future should be
completed, either successfully or in error, it should call the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">yield_result()</span></code> or <code class="xref py py-meth docutils literal notranslate"><span class="pre">yield_exception()</span></code> methods on the appropriate
<a class="reference internal" href="#more_executors.poll.PollDescriptor" title="more_executors.poll.PollDescriptor"><code class="xref py py-class docutils literal notranslate"><span class="pre">more_executors.poll.PollDescriptor</span></code></a>.</li>
<li>If the poll function raises an exception, all futures depending on that poll
will fail with that exception.  The poll function will be retried later.</li>
<li>If the poll function returns an int or float, it is used as the delay
in seconds until the next poll.</li>
</ul>
</div>
<div class="section" id="cancel-function">
<span id="id2"></span><h3>Cancel function<a class="headerlink" href="#cancel-function" title="Permalink to this headline">¶</a></h3>
<p>The cancel function has the following semantics:</p>
<ul class="simple">
<li>It’s called when cancel is requested on a future returned by this executor,
if and only if the future is currently in the list of futures being polled,
i.e. it will not be called if the delegate future has not yet completed.</li>
<li>It’s called with a single argument: the value returned by the delegate
future.</li>
<li>It should return <cite>True</cite> if the future can be cancelled.</li>
<li>If the cancel function raises an exception, the future’s cancel method will
return <cite>False</cite> and a message will be logged.</li>
</ul>
</div>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>Consider a web service which executes tasks asynchronously, with an API like
this:</p>
<ul>
<li><p class="first">To create a task: <cite>POST https://myservice/object/:id/publish</cite></p>
<blockquote>
<div><ul class="simple">
<li>Returns an identifier for a task, such as <cite>{“task_id”: 123}</cite></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">To get status of a single task: <cite>GET https://myservice/tasks/:id</cite></p>
<blockquote>
<div><ul class="simple">
<li>Returns task status, such as <cite>{“task_id”: 123, “state”: “finished”}</cite></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">To cancel a single task: <cite>DELETE https://myservice/tasks/:id</cite></p>
</li>
<li><p class="first">To search for status of multiple tasks:
<cite>POST https://myservice/tasks/search {“task_id”: [123, 456, …]}</cite></p>
<blockquote>
<div><ul class="simple">
<li>Returns array of task statuses, such as:</li>
</ul>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">[{</span><span class="nt">&quot;task_id&quot;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span> <span class="nt">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;finished&quot;</span><span class="p">},</span>
 <span class="p">{</span><span class="nt">&quot;task_id&quot;</span><span class="p">:</span> <span class="mi">456</span><span class="p">,</span> <span class="nt">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="nt">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">}]</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p>Imagine we want to run many tasks concurrently and monitor their status.
Two obvious approaches include:</p>
<ul>
<li><p class="first">We could make a function which starts a task and polls that task until
it completes, and have several threads run that function for different tasks.</p>
<ul class="simple">
<li>This could be easily encapsulated as a future using only the executors
from <a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#module-concurrent.futures" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">concurrent.futures</span></code></a>, but is very inefficient - each task in
progress will consume a thread for polling.</li>
</ul>
</li>
<li><p class="first">We could maintain a list of all outstanding tasks and implement a
special-purpose function to wait for all of them to complete.</p>
<blockquote>
<div><ul class="simple">
<li>This is efficient as only one request is needed per poll interval, but
since tasks aren’t represented as futures, useful features from
<a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#module-concurrent.futures" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">concurrent.futures</span></code></a> cannot be used and different types of
asynchronous work will be handled inconsistently.</li>
</ul>
</div></blockquote>
</li>
</ul>
<p><a class="reference internal" href="#more_executors.poll.PollExecutor" title="more_executors.poll.PollExecutor"><code class="xref py py-class docutils literal notranslate"><span class="pre">more_executors.poll.PollExecutor</span></code></a> bridges the gap between the two
approaches.  By providing a custom poll function, the tasks can be monitored
by one thread efficiently, while at the same time allowing full usage of the
API provided by <cite>Future</cite> objects.</p>
<p>In this example, the poll function would look similar to this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">poll_tasks</span><span class="p">(</span><span class="n">poll_descriptors</span><span class="p">):</span>
    <span class="c1"># Collect tasks we&#39;ll need to search for</span>
    <span class="n">task_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;task_id&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">poll_descriptors</span><span class="p">]</span>

    <span class="c1"># Search for status of these tasks</span>
    <span class="n">search</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;task_id&quot;</span><span class="p">:</span> <span class="n">task_ids</span><span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s1">&#39;https://myservice/tasks/search&#39;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">search</span><span class="p">)</span>

    <span class="c1"># If request failed then all outstanding futures fail</span>
    <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

    <span class="c1"># Request passed, resolve futures accordingly</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">{</span><span class="n">task</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;task_id&#39;</span><span class="p">):</span> <span class="n">task</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()}</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">poll_descriptors</span><span class="p">:</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">tasks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;finished&#39;</span><span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">yield_result</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">yield_exception</span><span class="p">(</span><span class="n">TaskFailed</span><span class="p">())</span>
</pre></div>
</div>
<p>To ensure that calling <cite>future.cancel()</cite> also cancels tasks on the
remote service, we can also provide a cancel function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cancel_task</span><span class="p">(</span><span class="n">task</span><span class="p">):</span>
    <span class="n">task_id</span> <span class="o">=</span> <span class="n">task</span><span class="p">[</span><span class="s1">&#39;task_id&#39;</span><span class="p">]</span>

    <span class="c1"># Attempt to DELETE this task</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
        <span class="s1">&#39;https://myservice/tasks/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">task_id</span><span class="p">)</span>

    <span class="c1"># Succeeded only if response was OK.</span>
    <span class="c1"># Otherwise, we may have been too late to cancel.</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span>
</pre></div>
</div>
<p>With the poll and cancel functions in place, futures could be created
like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">publish</span><span class="p">(</span><span class="n">object_id</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s1">&#39;https://myservice/object/</span><span class="si">%s</span><span class="s1">/publish&#39;</span> <span class="o">%</span> <span class="n">object_id</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<span class="c1"># Submit up to 4 HTTP requests at a time,</span>
<span class="c1"># and poll for the returned tasks using our poll function.</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span>\
    <span class="n">threadpool</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">with_poll</span><span class="p">(</span><span class="n">poll_tasks</span><span class="p">,</span> <span class="n">cancel_task</span><span class="p">)</span>
<span class="n">futures</span> <span class="o">=</span> <span class="p">[</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">publish</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">)]</span>

<span class="c1"># Now we can use concurrent.futures API to get tasks as</span>
<span class="c1"># the poll function determines they&#39;ve completed</span>
<span class="k">for</span> <span class="n">completed</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<dl class="class">
<dt id="more_executors.poll.PollExecutor">
<em class="property">class </em><code class="descclassname">more_executors.poll.</code><code class="descname">PollExecutor</code><span class="sig-paren">(</span><em>delegate</em>, <em>poll_fn</em>, <em>cancel_fn=None</em>, <em>default_interval=5.0</em>, <em>logger=None</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.poll.PollExecutor" title="Permalink to this definition">¶</a></dt>
<dd><p>Instances of <cite>PollExecutor</cite> submit callables to a delegate executor
and resolve the returned futures via a provided poll function.</p>
<p>A cancel function may also be provided to perform additional processing
when a returned future is cancelled.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>delegate</strong> (<a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Executor" title="(in Python v3.7)"><em>Executor</em></a>) – executor to which callables will be submitted</li>
<li><strong>poll_fn</strong> (<em>callable</em>) – a <a class="reference internal" href="#poll-function">poll function</a> used to decide when futures should be resolved</li>
<li><strong>cancel_fn</strong> (<em>callable</em>) – a <a class="reference internal" href="#cancel-function">cancel function</a> invoked when future cancel is required</li>
<li><strong>default_interval</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – default interval between polls (in seconds)</li>
<li><strong>logger</strong> (<a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.Logger" title="(in Python v3.7)"><em>Logger</em></a>) – a logger used for messages from this executor</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="more_executors.Executors.with_poll">
<em class="property">classmethod </em><code class="descclassname">Executors.</code><code class="descname">with_poll</code><span class="sig-paren">(</span><em>executor</em>, <em>poll_fn</em>, <em>cancel_fn=None</em>, <em>default_interval=5.0</em>, <em>logger=None</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.Executors.with_poll" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">a new executor which produces polled futures.<p>Submitted callables will have their output passed into
a poll function.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#more_executors.poll.PollExecutor" title="more_executors.poll.PollExecutor">PollExecutor</a></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="more_executors.poll.PollDescriptor">
<em class="property">class </em><code class="descclassname">more_executors.poll.</code><code class="descname">PollDescriptor</code><a class="headerlink" href="#more_executors.poll.PollDescriptor" title="Permalink to this definition">¶</a></dt>
<dd><p>Represents an unresolved <a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Future" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Future</span></code></a>.</p>
<p>The poll function used by <a class="reference internal" href="#more_executors.poll.PollExecutor" title="more_executors.poll.PollExecutor"><code class="xref py py-class docutils literal notranslate"><span class="pre">PollExecutor</span></code></a> will be
invoked with a list of PollDescriptor objects.</p>
<p>Create new instance of PollDescriptor(result, yield_result, yield_exception)</p>
<dl class="attribute">
<dt id="more_executors.poll.PollDescriptor.result">
<code class="descname">result</code><a class="headerlink" href="#more_executors.poll.PollDescriptor.result" title="Permalink to this definition">¶</a></dt>
<dd><p>The result from the delegate executor’s future, which should be used to
drive the poll.</p>
</dd></dl>

<dl class="attribute">
<dt id="more_executors.poll.PollDescriptor.yield_exception">
<code class="descname">yield_exception</code><a class="headerlink" href="#more_executors.poll.PollDescriptor.yield_exception" title="Permalink to this definition">¶</a></dt>
<dd><p>The poll function can call this function to make the future raise the given exception.</p>
</dd></dl>

<dl class="attribute">
<dt id="more_executors.poll.PollDescriptor.yield_result">
<code class="descname">yield_result</code><a class="headerlink" href="#more_executors.poll.PollDescriptor.yield_result" title="Permalink to this definition">¶</a></dt>
<dd><p>The poll function can call this function to make the future yield the given result.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="asyncio">
<h2>asyncio<a class="headerlink" href="#asyncio" title="Permalink to this headline">¶</a></h2>
<p>AsyncioExecutor transforms <a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#module-concurrent.futures" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">concurrent.futures</span></code></a> futures into
<a class="reference external" href="https://docs.python.org/3/library/asyncio.html#module-asyncio" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> futures.</p>
<dl class="class">
<dt id="more_executors.asyncio.AsyncioExecutor">
<em class="property">class </em><code class="descclassname">more_executors.asyncio.</code><code class="descname">AsyncioExecutor</code><span class="sig-paren">(</span><em>delegate</em>, <em>loop=None</em>, <em>logger=None</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.asyncio.AsyncioExecutor" title="Permalink to this definition">¶</a></dt>
<dd><p>An executor which delegates to another executor while converting
returned futures into instances of <a class="reference external" href="https://docs.python.org/3/library/asyncio-future.html#asyncio.Future" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">asyncio.Future</span></code></a>.</p>
<p>Note that since this class produces <a class="reference external" href="https://docs.python.org/3/library/asyncio.html#module-asyncio" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> rather than <a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#module-concurrent.futures" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">concurrent.futures</span></code></a>
future objects, AsyncioExecutor instances themselves cannot be used
as a delegate executor of other executor instances within this library.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 1.7.0.</span></p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>delegate</strong> (<a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Executor" title="(in Python v3.7)"><em>Executor</em></a>) – executor to which callables will be submitted</li>
<li><strong>loop</strong> (<a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.AbstractEventLoop" title="(in Python v3.7)"><em>AbstractEventLoop</em></a>) – asyncio event loop used to wrap futures; if omitted, the default
event loop is used.</li>
<li><strong>logger</strong> (<a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.Logger" title="(in Python v3.7)"><em>Logger</em></a>) – a logger used for messages from this executor</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="more_executors.Executors.with_asyncio">
<em class="property">classmethod </em><code class="descclassname">Executors.</code><code class="descname">with_asyncio</code><span class="sig-paren">(</span><em>executor</em>, <em>loop=None</em>, <em>logger=None</em><span class="sig-paren">)</span><a class="headerlink" href="#more_executors.Executors.with_asyncio" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">a new executor which returns <a class="reference external" href="https://docs.python.org/3/library/asyncio-future.html#asyncio.Future" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">asyncio.Future</span></code></a> instances
rather than <a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Future" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">concurrent.futures.Future</span></code></a> instances, i.e. may be used
with the <cite>await</cite> keyword and coroutines.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#more_executors.asyncio.AsyncioExecutor" title="more_executors.asyncio.AsyncioExecutor">AsyncioExecutor</a></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Since the other executors from <code class="xref py py-class docutils literal notranslate"><span class="pre">Executors</span></code> class are designed
for use with <a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Future" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">concurrent.futures.Future</span></code></a>, if an executor is being
configured using chained <cite>with_*</cite> methods, this must be the last method called.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only usable for Python &gt;= 3.5.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 1.7.0.</span></p>
</div>
</dd></dl>

</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">more-executors</a></h1>



<p class="blurb">A library of composable Python executors</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=rohanpm&repo=more-executors&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p>
<a class="badge" href="https://travis-ci.org/rohanpm/more-executors">
    <img
        alt="https://secure.travis-ci.org/rohanpm/more-executors.svg?branch=master"
        src="https://secure.travis-ci.org/rohanpm/more-executors.svg?branch=master"
    />
</a>
</p>


<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="user-guide.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#bind">bind</a></li>
<li class="toctree-l2"><a class="reference internal" href="#concurrent-futures">concurrent.futures</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sync">sync</a></li>
<li class="toctree-l2"><a class="reference internal" href="#retry">retry</a></li>
<li class="toctree-l2"><a class="reference internal" href="#map">map</a></li>
<li class="toctree-l2"><a class="reference internal" href="#flat-map">flat map</a></li>
<li class="toctree-l2"><a class="reference internal" href="#timeout">timeout</a></li>
<li class="toctree-l2"><a class="reference internal" href="#throttle">throttle</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cancel-on-shutdown">cancel on shutdown</a></li>
<li class="toctree-l2"><a class="reference internal" href="#poll">poll</a></li>
<li class="toctree-l2"><a class="reference internal" href="#asyncio">asyncio</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="user-guide.html" title="previous chapter">User Guide</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Rohan McGovern.
      
      |
      <a href="_sources/api-reference.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>